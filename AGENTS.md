# JobFit (Resume Tailor) - Project Blueprint

## 1. Project Goal
Build a local-first AI agent that helps users tailor their resumes to specific job descriptions.
- **No Auth:** This is a single-user local tool. No user login required.
- **Frontend:** React + Tailwind (Pre-built in `/frontend`).
- **Backend:** FastAPI (Python 3.12+).
- **Database:** SQLite (via SQLModel).
- **Agent:** PydanticAI.

## 2. Architecture & Tech Stack

### Backend (`/backend`)
- **Package Manager:** `uv`.
- **Web Framework:** `fastapi` + `uvicorn`.
- **Database:** `sqlmodel` (SQLite).
- **Agent Framework:** `pydantic-ai`.
- **Tools:**
    - `httpx`: For scraping Jina URLs (`https://r.jina.ai/...`).
    - `markitdown` (or `pypdf`): To convert uploaded PDF resumes into text/markdown for the LLM.
    - `jinja2` + `weasyprint`: For generating the final PDF download.
- **Linting:** `ruff` (Dev dependency).

### Database Schema (SQLModel)
1. **Table `Resume` (The Source)**
   - `id`: int (PK)
   - `name`: str (e.g., "Master Backend CV")
   - `content`: str (The raw markdown/text extracted from the uploaded PDF)
   - `is_selected`: bool (Default=False)

2. **Table `Job` (The Application)**
   - `id`: int (PK)
   - `resume_id`: int (Foreign Key -> Resume.id). *Tracks which resume was used.*
   - `url`: str
   - `company`: str
   - `title`: str
   - `original_jd`: str (Text scraped from Jina)
   - `resume`: str (The new Markdown content generated by AI)
   - `match_score`: int (0-100)
   - `status`: str (Enum: "todo", "applied", "interview")
   - `created_at`: datetime

## 3. API Contract

**1. POST /api/resumes/upload**
- **Input:** Multipart File (PDF).
- **Logic:** Use `markitdown` to extract text. Save to `Resume` table.
- **Output:** `{ "id": 1, "name": "filename.pdf", "preview": "..." }`

**2. POST /api/analyze**
- **Input:** `{ "url": "...", "resume_id": 1 }`
- **Logic:**
    1. Fetch `Resume.content` using `resume_id`.
    2. Agent Tool: Scrape Job URL.
    3. Agent Logic: Rewrite resume content to match JD.
    4. Save to `Job` table with `resume_id` link.
- **Output:** `{ "job_id": 1, "score": 85, "company": "Google" }`

**3. POST /api/jobs/{id}/pdf**
- **Logic:** Render `Job.resume` to PDF using Jinja2 + WeasyPrint.
- **Output:** File download.

## 4. Engineering Standards

### Testing
- **Patterns:**
    - **In-Memory DB:** Use `sqlite:///:memory:` with `StaticPool` for fast, isolated test runs.
    - **Transactional Isolation:** Wrap tests in a `db_session` fixture that rolls back changes after each test.
    - **Dependency Injection:** Use `app.dependency_overrides` to inject test sessions into FastAPI endpoints.
    - **Fixture-Driven:** Keep `conftest.py` for shared fixtures (`client`, `db_session`, `sample_data`).
- **Unit:** Test PDF extraction and scraper logic with mocks.
- **Integration:** Test end-to-end API flows (e.g., `/analyze`) by mocking external LLM responses.

### CI/CD
- GitHub Actions: Run `ruff check` and `pytest` on push.

### MCP Implementation
- Define `scrape_job_description` as a standalone PydanticAI tool.

### ETC
    # Sync dependencies from lockfile
    uv sync
    # Add a new package
    uv add <PACKAGE-NAME>
    # Run Python files
    uv run python <PYTHON-FILE>

    #commit with suitable message. The message should be bullet point style, simple, and concise.
    git commit -m "<MESSAGE>"

    # LIBRARY VERSIONING
    1. Always check `package.json`, `pyproject.toml`, or `mix.exs` first to find installed versions.
    2. If the version is very new (released in late 2024/2025) or if you are unsure about breaking changes, USE `context7` to fetch the documentation.
    3. Do not guess on major version upgrades (e.g., Python 3.12 -> 3.13, Tailwind 3 -> 4).

    # TOOL USAGE RULES
    Always use the `context7` tool when I ask for code generation, setup steps, or library documentation.
    - You do NOT need to ask for permission.
    - If I mention a library (e.g., "Airflow", "Next.js"), automatically use `context7` to find the latest docs for it.
    - If you are unsure which version I am using, use `context7` to check the latest stable version.
    - When you tried twice to fix an error and still can't fix it, use the context7 tool to find the solution.

    # For md files
    - Don't use convoluted language. e.g., 
        - saving massive amounts of bandwidth -> saving bandwidth
        - powerful tools -> tools
    - No need to use analogies or metaphors unless asked to.

    # COMMIT MESSAGES
    - never use quatations (", ', `) as they cause issue with git commit -m ""
    